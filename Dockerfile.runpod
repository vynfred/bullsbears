# BullsBears AI - RunPod Deployment
FROM runpod/pytorch:2.1.0-py3.10-cuda11.8.0-devel-ubuntu22.04

# Set working directory
WORKDIR /workspace

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    git \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install Ollama
RUN curl -fsSL https://ollama.ai/install.sh | sh

# Copy our setup script
COPY scripts/runpod_setup.sh /workspace/setup.sh
RUN chmod +x /workspace/setup.sh

# Copy agent system files
COPY backend/ /workspace/bullsbears/backend/
COPY scripts/ /workspace/bullsbears/scripts/
COPY .env /workspace/bullsbears/.env

# Install Python dependencies
RUN pip install --no-cache-dir \
    fastapi \
    uvicorn \
    asyncio \
    aiohttp \
    asyncpg \
    python-dotenv \
    yfinance \
    pandas \
    numpy

# Set environment variables
ENV OLLAMA_HOST=0.0.0.0:11434
ENV OLLAMA_MODELS=/workspace/models
ENV PYTHONPATH=/workspace/bullsbears

# Expose Ollama port
EXPOSE 11434

# Expose FastAPI port (if we add API endpoints)
EXPOSE 8000

# Start script
CMD ["/workspace/setup.sh"]
