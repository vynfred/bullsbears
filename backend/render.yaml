# render.yaml - BullsBears v5 Infrastructure
# ============================================
# Web Service: FastAPI backend
# Cron Jobs: Daily pipeline (8:00 AM ET) + Weekly learner (4:10 AM ET Monday)
# ============================================

services:
  - type: web
    name: bullsbears-api
    env: python
    region: virginia
    plan: free
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: ENVIRONMENT
        value: production

  # Daily Pipeline Cron Job
  # Runs at 8:00 AM ET (13:00 UTC) on weekdays
  # Pipeline: FMP Delta → Prescreen → Charts → Vision → Social → Arbitrator
  - type: cron
    name: bullsbears-daily-pipeline
    env: python
    region: virginia
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "0 13 * * 1-5"
    startCommand: python scripts/run_daily_pipeline.py

  # Weekly Learner Cron Job
  # Runs at 4:10 AM ET (9:10 UTC) on Saturdays
  # Analyzes past week's outcomes and updates weights.json
  - type: cron
    name: bullsbears-weekly-learner
    env: python
    region: virginia
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "10 9 * * 6"
    startCommand: python scripts/run_weekly_learner.py