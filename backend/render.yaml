# render.yaml - BullsBears v5 Infrastructure
# ============================================
# Web Service: FastAPI backend
# Cron Jobs:
#   - Daily pipeline (8:00 AM ET weekdays)
#   - Outcome monitor (10 AM + 4:30 PM ET weekdays)
#   - Weekly learner (4:10 AM ET Saturdays)
#
# IMPORTANT: All services share the "bullsbears-env" environment group
# Create this group in Render Dashboard with these keys:
#   - DATABASE_URL (from Render Postgres)
#   - REDIS_URL (from Render Redis)
#   - FIREWORKS_API_KEY
#   - GROQ_API_KEY
#   - GROK_API_KEY
#   - FMP_API_KEY
#   - FIREBASE_SERVICE_ACCOUNT (full JSON string)
# ============================================

services:
  - type: web
    name: bullsbears-api
    env: python
    region: virginia
    plan: free
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: ENVIRONMENT
        value: production
      - fromGroup: bullsbears-env

  # Daily Pipeline Cron Job
  # Runs at 8:00 AM ET (13:00 UTC) on weekdays
  # Pipeline: FMP Delta → Prescreen → Charts → Vision → Social → Arbitrator
  - type: cron
    name: bullsbears-daily-pipeline
    env: python
    region: virginia
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "0 13 * * 1-5"
    startCommand: python scripts/run_daily_pipeline.py
    envVars:
      - key: ENVIRONMENT
        value: production
      - fromGroup: bullsbears-env

  # Outcome Monitor Cron Job - Morning
  # Runs at 10:00 AM ET (15:00 UTC) on weekdays
  # Checks picks for target hits and updates summaries
  - type: cron
    name: bullsbears-outcome-monitor-am
    env: python
    region: virginia
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "0 15 * * 1-5"
    startCommand: python scripts/run_outcome_monitor.py
    envVars:
      - key: ENVIRONMENT
        value: production
      - fromGroup: bullsbears-env

  # Outcome Monitor Cron Job - Afternoon
  # Runs at 4:30 PM ET (21:30 UTC) on weekdays
  # Checks picks for target hits after market close
  - type: cron
    name: bullsbears-outcome-monitor-pm
    env: python
    region: virginia
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "30 21 * * 1-5"
    startCommand: python scripts/run_outcome_monitor.py
    envVars:
      - key: ENVIRONMENT
        value: production
      - fromGroup: bullsbears-env

  # Weekly Learner Cron Job
  # Runs at 4:10 AM ET (9:10 UTC) on Saturdays
  # Analyzes past week's outcomes and updates weights.json
  - type: cron
    name: bullsbears-weekly-learner
    env: python
    region: virginia
    repo: https://github.com/vynfred/bullsbears
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    schedule: "10 9 * * 6"
    startCommand: python scripts/run_weekly_learner.py
    envVars:
      - key: ENVIRONMENT
        value: production
      - fromGroup: bullsbears-env